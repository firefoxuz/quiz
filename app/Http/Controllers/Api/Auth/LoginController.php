<?php

namespace App\Http\Controllers\Api\Auth;

use App\Http\Controllers\Api\BaseController;
use App\Services\FaceData;
use App\Traits\ApiResponser;
use Auth;
use Carbon\Carbon;
use Illuminate\Http\Request;

/**
 *
 * @OA\Schemas (
 *   @OA\Schema(
 *     schema="FaceData",
 *     type="object",
 *     example={
 *  {
 *      "status": "success",
 *      "message": "Retrieved successfully",
 *      "data": {
 *          {
 *              "face_token": "2|54b598eaf456d2e3cff3c6ed70ab19e9",
 *              "description": {
 *                  {
 *                      "0": -0.08354894816875458,
 *                      "1": 0.14503398537635803,
 *                      "2": 0.06132391840219498,
 *                      "3": -0.03724698722362518,
 *                      "4": 0.005590589251369238,
 *                      "5": -0.0067224521189928055,
 *                      "6": -0.1312861144542694,
 *                      "7": -0.06689407676458359,
 *                      "8": 0.19573211669921875,
 *                      "9": -0.1358477920293808,
 *                      "10": 0.24607376754283905,
 *                      "11": 0.07514014095067978,
 *                      "12": -0.23605580627918243,
 *                      "13": -0.13448695838451383,
 *                      "14": 0.08451203256845474,
 *                      "15": 0.15729592740535736,
 *                      "16": -0.2332305908203125,
 *                      "17": -0.08095985651016235,
 *                      "18": -0.1228293552994728,
 *                      "19": -0.0692969262599945,
 *                      "20": -0.013255991041660309,
 *                      "21": 0.004863293841481209,
 *                      "22": 0.08727063983678818,
 *                      "23": 0.055344268679618835,
 *                      "24": -0.07954764366149902,
 *                      "25": -0.3781010508537293,
 *                      "26": -0.059593092650175095,
 *                      "27": -0.13934333622455597,
 *                      "28": -0.017023976892232895,
 *                      "29": -0.1742968112230301,
 *                      "30": -0.1014869660139084,
 *                      "31": -0.04351004213094711,
 *                      "32": -0.1655755490064621,
 *                      "33": -0.09985846281051636,
 *                      "34": -0.011279848404228687,
 *                      "35": -8.42604786157608e-5,
 *                      "36": 0.011499358341097832,
 *                      "37": -0.00027435808442533016,
 *                      "38": 0.17678231000900269,
 *                      "39": 0.04107140004634857,
 *                      "40": -0.14285074174404144,
 *                      "41": 0.05507363006472587,
 *                      "42": -0.022574342787265778,
 *                      "43": 0.22061309218406677,
 *                      "44": 0.26339441537857056,
 *                      "45": 0.1156783401966095,
 *                      "46": 0.02186393365263939,
 *                      "47": -0.0534970685839653,
 *                      "48": 0.1272212713956833,
 *                      "49": -0.2239537239074707,
 *                      "50": 0.0532730296254158,
 *                      "51": 0.17314405739307404,
 *                      "52": 0.08673956245183945,
 *                      "53": 0.011491382494568825,
 *                      "54": 0.11317386478185654,
 *                      "55": -0.20246416330337524,
 *                      "56": -0.0404944121837616,
 *                      "57": 0.09741079062223434,
 *                      "58": -0.0706252008676529,
 *                      "59": 0.04773471504449845,
 *                      "60": 0.05539631098508835,
 *                      "61": -0.07121086865663528,
 *                      "62": 0.0182386077940464,
 *                      "63": 0.05581909790635109,
 *                      "64": 0.1977865993976593,
 *                      "65": 0.055604640394449234,
 *                      "66": -0.12007252126932144,
 *                      "67": -0.05448825657367706,
 *                      "68": 0.10982170701026917,
 *                      "69": -0.030862288549542427,
 *                      "70": -0.006374970078468323,
 *                      "71": -0.0006062304601073265,
 *                      "72": -0.17770656943321228,
 *                      "73": -0.22483938932418823,
 *                      "74": -0.2720988094806671,
 *                      "75": 0.06056298688054085,
 *                      "76": 0.341403603553772,
 *                      "77": 0.1641249656677246,
 *                      "78": -0.21040311455726624,
 *                      "79": -0.007556699216365814,
 *                      "80": -0.1500783413648605,
 *                      "81": 0.014206179417669771,
 *                      "82": 0.0562804713845253,
 *                      "83": 0.064797542989254,
 *                      "84": -0.06042851507663727,
 *                      "85": -0.07584649324417114,
 *                      "86": -0.08648885786533356,
 *                      "87": 0.03911668062210083,
 *                      "88": 0.1103191301226616,
 *                      "89": 0.04781587794423103,
 *                      "90": -0.007700640708208084,
 *                      "91": 0.19867144525051117,
 *                      "92": -0.040879085659980774,
 *                      "93": 0.04564366489648819,
 *                      "94": -0.0029121283441782,
 *                      "95": 0.01840968430042267,
 *                      "96": -0.13607127964496613,
 *                      "97": -0.030971627682447433,
 *                      "98": -0.16637998819351196,
 *                      "99": -0.04227082431316376,
 *                      "100": -0.009851403534412384,
 *                      "101": -0.024227065965533257,
 *                      "102": -0.004427498206496239,
 *                      "103": 0.10575050115585329,
 *                      "104": -0.1843499094247818,
 *                      "105": 0.05705485120415688,
 *                      "106": 0.007500626146793365,
 *                      "107": -0.032734744250774384,
 *                      "108": -0.03046466037631035,
 *                      "109": 0.10936861485242844,
 *                      "110": -0.08356362581253052,
 *                      "111": -0.05610128492116928,
 *                      "112": 0.09241364151239397,
 *                      "113": -0.20301245152950287,
 *                      "114": 0.22154057025909424,
 *                      "115": 0.2742663621902466,
 *                      "116": 0.029420409351587296,
 *                      "117": 0.15983536839485168,
 *                      "118": 0.07180958241224289,
 *                      "119": 0.07173017412424088,
 *                      "120": -0.017871571704745293,
 *                      "121": -0.010782327502965929,
 *                      "122": -0.13219250738620758,
 *                      "123": -0.092707522213459,
 *                      "124": 0.023704705759882927,
 *                      "125": 0.07283918559551239,
 *                      "126": 0.09126794338226318,
 *                      "127": 0.002603450557217002
 *                  },
 *                  {
 *                      "0": -0.09116155654191972,
 *                      "1": 0.16720132529735565,
 *                      "2": 0.02999735996127129,
 *                      "3": -0.04778226464986801,
 *                      "4": 0.00811825878918171,
 *                      "5": -0.005473787896335125,
 *                      "6": -0.06043289229273796,
 *                      "7": -0.08689433336257935,
 *                      "8": 0.21131987869739532,
 *                      "9": -0.13833774626255035,
 *                      "10": 0.2583532929420471,
 *                      "11": 0.02965177409350872,
 *                      "12": -0.1943267434835434,
 *                      "13": -0.13571801781654358,
 *                      "14": 0.07501313090324402,
 *                      "15": 0.13327576220035553,
 *                      "16": -0.23286287486553192,
 *                      "17": -0.06684746593236923,
 *                      "18": -0.13838329911231995,
 *                      "19": -0.03507774695754051,
 *                      "20": 0.025967281311750412,
 *                      "21": 0.026608197018504143,
 *                      "22": 0.12859594821929932,
 *                      "23": 0.030428724363446236,
 *                      "24": -0.1061270460486412,
 *                      "25": -0.35487526655197144,
 *                      "26": -0.039824485778808594,
 *                      "27": -0.15894123911857605,
 *                      "28": 0.017959270626306534,
 *                      "29": -0.1391320377588272,
 *                      "30": -0.08958211541175842,
 *                      "31": -0.061139803379774094,
 *                      "32": -0.21621114015579224,
 *                      "33": -0.1128436028957367,
 *                      "34": -0.024585843086242676,
 *                      "35": 0.015975160524249077,
 *                      "36": -0.03231247141957283,
 *                      "37": 0.011561190709471704,
 *                      "38": 0.22118936479091644,
 *                      "39": 0.037972524762153625,
 *                      "40": -0.16261811554431915,
 *                      "41": 0.09368130564689636,
 *                      "42": -0.047997429966926575,
 *                      "43": 0.24009178578853607,
 *                      "44": 0.24578511714935303,
 *                      "45": 0.11444180458784103,
 *                      "46": -0.028003789484500885,
 *                      "47": -0.09119530022144318,
 *                      "48": 0.1511114239692688,
 *                      "49": -0.2417483776807785,
 *                      "50": 0.06794346868991852,
 *                      "51": 0.16659894585609436,
 *                      "52": 0.05808278918266296,
 *                      "53": 0.03168705478310585,
 *                      "54": 0.0744846910238266,
 *                      "55": -0.15849623084068298,
 *                      "56": 0.0147368423640728,
 *                      "57": 0.05250387638807297,
 *                      "58": -0.1122962161898613,
 *                      "59": 0.01624598540365696,
 *                      "60": 0.08966932445764542,
 *                      "61": -0.052976418286561966,
 *                      "62": 0.009514335542917252,
 *                      "63": 0.02821814827620983,
 *                      "64": 0.236803337931633,
 *                      "65": 0.046044182032346725,
 *                      "66": -0.12675726413726807,
 *                      "67": -0.05589994415640831,
 *                      "68": 0.0912623479962349,
 *                      "69": -0.04212276637554169,
 *                      "70": -0.024022942408919334,
 *                      "71": 0.012539918534457684,
 *                      "72": -0.1523219496011734,
 *                      "73": -0.19912216067314148,
 *                      "74": -0.2868398427963257,
 *                      "75": 0.05622493475675583,
 *                      "76": 0.3719650208950043,
 *                      "77": 0.1358574777841568,
 *                      "78": -0.21657823026180267,
 *                      "79": -0.00260162353515625,
 *                      "80": -0.1863964796066284,
 *                      "81": 0.005097066052258015,
 *                      "82": 0.07255164533853531,
 *                      "83": 0.08284054696559906,
 *                      "84": -0.0459827296435833,
 *                      "85": -0.055929966270923615,
 *                      "86": -0.08290459215641022,
 *                      "87": 0.019675133749842644,
 *                      "88": 0.13227128982543945,
 *                      "89": -0.00768733024597168,
 *                      "90": -0.04049910232424736,
 *                      "91": 0.2320333272218704,
 *                      "92": -0.012287506833672523,
 *                      "93": 0.06325152516365051,
 *                      "94": 0.0015436559915542605,
 *                      "95": 0.003171172458678484,
 *                      "96": -0.14248225092887878,
 *                      "97": -0.027270382270216945,
 *                      "98": -0.15948078036308289,
 *                      "99": -0.013800128363072872,
 *                      "100": 0.01091778464615345,
 *                      "101": -0.04393923655152321,
 *                      "102": -0.0413457527756691,
 *                      "103": 0.1318131685256958,
 *                      "104": -0.2324381023645401,
 *                      "105": 0.15110398828983307,
 *                      "106": 0.011454432271420956,
 *                      "107": -0.03234049677848816,
 *                      "108": 0.01089049968868494,
 *                      "109": 0.05941133946180344,
 *                      "110": -0.0792127177119255,
 *                      "111": -0.041468679904937744,
 *                      "112": 0.07929004728794098,
 *                      "113": -0.22821861505508423,
 *                      "114": 0.2615351378917694,
 *                      "115": 0.2440764158964157,
 *                      "116": 0.04853691905736923,
 *                      "117": 0.16842922568321228,
 *                      "118": 0.08917742222547531,
 *                      "119": 0.060688696801662445,
 *                      "120": -0.028489744290709496,
 *                      "121": 0.07126962393522263,
 *                      "122": -0.19933702051639557,
 *                      "123": -0.11219384521245956,
 *                      "124": 0.04827271401882171,
 *                      "125": 0.06292625516653061,
 *                      "126": 0.09687796235084534,
 *                      "127": 0.02589738927781582
 *                  }
 *              }
 *          },
 *          {
 *              "face_token": "1|456c0e7f51991d54951aced6f14230eb",
 *              "description": {
 *                  {
 *                      "0": -0.11568763852119446,
 *                      "1": -0.019592750817537308,
 *                      "2": 0.008745255880057812,
 *                      "3": -0.05734182521700859,
 *                      "4": -0.035307627171278,
 *                      "5": -0.04643337056040764,
 *                      "6": 0.012120288796722887,
 *                      "7": -0.10893407464027403,
 *                      "8": 0.10416769236326218,
 *                      "9": 0.00039073178777471185,
 *                      "10": 0.23972442746162417,
 *                      "11": -0.09199199825525284,
 *                      "12": -0.2542029023170471,
 *                      "13": -0.07777778059244156,
 *                      "14": 0.026655163615942,
 *                      "15": 0.10408915579319,
 *                      "16": -0.14429283142089844,
 *                      "17": -0.10623788833618164,
 *                      "18": -0.19169048964977264,
 *                      "19": -0.1844751387834549,
 *                      "20": -0.004812292754650116,
 *                      "21": -0.025566037744283676,
 *                      "22": 0.10869406908750534,
 *                      "23": -0.05635254830121994,
 *                      "24": -0.1639249175786972,
 *                      "25": -0.3265687823295593,
 *                      "26": -0.09777209162712096,
 *                      "27": -0.07346636056900024,
 *                      "28": 0.04265899583697319,
 *                      "29": -0.04933641850948334,
 *                      "30": 0.07862618565559387,
 *                      "31": 0.009531448595225813,
 *                      "32": -0.26897603273391724,
 *                      "33": -0.11653920263051988,
 *                      "34": 0.0754937008023262,
 *                      "35": 0.06677001714706421,
 *                      "36": -0.02532503381371498,
 *                      "37": -0.1108940616250038,
 *                      "38": 0.18266505002975464,
 *                      "39": 0.033458270132541656,
 *                      "40": -0.1204250231385231,
 *                      "41": 0.027448860928416252,
 *                      "42": -0.003554641269147396,
 *                      "43": 0.2926340401172638,
 *                      "44": 0.1847376823425293,
 *                      "45": 0.041753556579351425,
 *                      "46": -0.040119633078575134,
 *                      "47": -0.07681023329496384,
 *                      "48": 0.0977686494588852,
 *                      "49": -0.2756921648979187,
 *                      "50": 0.0973399505019188,
 *                      "51": 0.13454726338386536,
 *                      "52": 0.12564221024513245,
 *                      "53": -0.04325353354215622,
 *                      "54": 0.12745283544063568,
 *                      "55": 0.0039712474681437016,
 *                      "56": 0.05415879189968109,
 *                      "57": 0.18428415060043335,
 *                      "58": -0.21513472497463224,
 *                      "59": 0.031338948756456375,
 *                      "60": 0.05403848737478256,
 *                      "61": -0.06167244911193848,
 *                      "62": -0.06737079471349716,
 *                      "63": -0.1804327666759491,
 *                      "64": 0.11360283195972444,
 *                      "65": 0.14721983671188354,
 *                      "66": -0.11564531177282332,
 *                      "67": -0.07528408616781235,
 *                      "68": 0.129261776804924,
 *                      "69": -0.038929834961891174,
 *                      "70": -0.023791873827576637,
 *                      "71": -0.01061880588531494,
 *                      "72": -0.1185065433382988,
 *                      "73": -0.2037563920021057,
 *                      "74": -0.3785519003868103,
 *                      "75": 0.04494326189160347,
 *                      "76": 0.4665711522102356,
 *                      "77": 0.061909403651952744,
 *                      "78": -0.23492270708084104,
 *                      "79": -0.016231298446655273,
 *                      "80": -0.03150119259953499,
 *                      "81": 0.030755246058106422,
 *                      "82": 0.08813642710447311,
 *                      "83": 0.05115705728530884,
 *                      "84": -0.10659606009721756,
 *                      "85": -0.04946782439947128,
 *                      "86": -0.058934636414051056,
 *                      "87": 0.03631361573934555,
 *                      "88": 0.15238507091999054,
 *                      "89": -0.08404015004634857,
 *                      "90": -0.11246760934591292,
 *                      "91": 0.16674743592739105,
 *                      "92": -0.0902326926589012,
 *                      "93": -0.03493214398622513,
 *                      "94": 0.05356312170624733,
 *                      "95": 0.06306540220975876,
 *                      "96": -0.11127959936857224,
 *                      "97": -0.01577775552868843,
 *                      "98": -0.11793425679206848,
 *                      "99": -0.013828380964696407,
 *                      "100": 0.10112372785806656,
 *                      "101": -0.10944845527410509,
 *                      "102": 0.02048296295106411,
 *                      "103": 0.09486795961856842,
 *                      "104": -0.17077624797821045,
 *                      "105": 0.0868876725435257,
 *                      "106": 0.00801670178771019,
 *                      "107": -0.08086156100034714,
 *                      "108": 0.04827927425503731,
 *                      "109": -0.05362436547875405,
 *                      "110": -0.04127708449959755,
 *                      "111": -0.051217932254076,
 *                      "112": 0.10903575271368028,
 *                      "113": -0.30255311727523804,
 *                      "114": 0.1676427572965622,
 *                      "115": 0.2582007050514221,
 *                      "116": -0.0721791684627533,
 *                      "117": 0.14855016767978668,
 *                      "118": 0.022982580587267876,
 *                      "119": 0.04643283784389496,
 *                      "120": -0.012225856073200704,
 *                      "121": 0.12497464567422868,
 *                      "122": -0.13806992769241333,
 *                      "123": -0.12069232016801834,
 *                      "124": -0.02679612673819065,
 *                      "125": 0.08782143145799637,
 *                      "126": -0.008785154670476913,
 *                      "127": 0.02443100698292255
 *                  },
 *                  {
 *                      "0": -0.09428981691598892,
 *                      "1": 0.18556907773017883,
 *                      "2": 0.031873371452093124,
 *                      "3": -0.03864876180887222,
 *                      "4": -0.2015826106071472,
 *                      "5": -0.03594347834587097,
 *                      "6": -0.03130538761615753,
 *                      "7": -0.11705919355154036,
 *                      "8": 0.10047462582588196,
 *                      "9": -0.06821352243423462,
 *                      "10": 0.2570832073688507,
 *                      "11": -0.057008057832717896,
 *                      "12": -0.15697714686393738,
 *                      "13": -0.03795250505208969,
 *                      "14": -0.015168851241469383,
 *                      "15": 0.15976780652999878,
 *                      "16": -0.11470402032136916,
 *                      "17": -0.15229055285453796,
 *                      "18": -0.1832367181777954,
 *                      "19": -0.09846197068691254,
 *                      "20": 0.01965220831334591,
 *                      "21": -0.05733521282672882,
 *                      "22": -0.07072660326957703,
 *                      "23": -0.02299196645617485,
 *                      "24": -0.09427186101675034,
 *                      "25": -0.34530752897262573,
 *                      "26": -0.05595511570572853,
 *                      "27": -0.09557901322841644,
 *                      "28": 0.10371595621109007,
 *                      "29": -0.10897258669137956,
 *                      "30": 0.059154756367206573,
 *                      "31": -0.001897148322314024,
 *                      "32": -0.2186114490032196,
 *                      "33": -0.12071258574724196,
 *                      "34": 0.04740617051720619,
 *                      "35": 0.004652056843042374,
 *                      "36": -0.09416276961565018,
 *                      "37": -0.029187001287937164,
 *                      "38": 0.17468741536140442,
 *                      "39": -0.05100622773170471,
 *                      "40": -0.17895177006721497,
 *                      "41": 0.1279159039258957,
 *                      "42": 0.1135171800851822,
 *                      "43": 0.23927299678325653,
 *                      "44": 0.18430167436599731,
 *                      "45": 0.04189230501651764,
 *                      "46": 0.08415257930755615,
 *                      "47": -0.06878908723592758,
 *                      "48": 0.10631056129932404,
 *                      "49": -0.2429588288068771,
 *                      "50": 0.0807647705078125,
 *                      "51": 0.08481840789318085,
 *                      "52": 0.12555715441703796,
 *                      "53": 0.10736656934022903,
 *                      "54": 0.18369869887828827,
 *                      "55": -0.14456233382225037,
 *                      "56": 0.05086872726678848,
 *                      "57": 0.1407345086336136,
 *                      "58": -0.16993844509124756,
 *                      "59": 0.055087752640247345,
 *                      "60": 0.10854418575763702,
 *                      "61": -0.05505949258804321,
 *                      "62": -0.0952054038643837,
 *                      "63": -0.020915962755680084,
 *                      "64": 0.2460847944021225,
 *                      "65": 0.1436379849910736,
 *                      "66": -0.02328523620963097,
 *                      "67": -0.15862220525741577,
 *                      "68": 0.20225578546524048,
 *                      "69": -0.07249625027179718,
 *                      "70": -0.06546330451965332,
 *                      "71": 0.010998409241437912,
 *                      "72": -0.06439642608165741,
 *                      "73": -0.07956651598215103,
 *                      "74": -0.3081102669239044,
 *                      "75": 0.08872397243976593,
 *                      "76": 0.39808136224746704,
 *                      "77": 0.12074775248765944,
 *                      "78": -0.2061399072408676,
 *                      "79": 0.04298992082476616,
 *                      "80": -0.03767102211713791,
 *                      "81": 0.05710409954190254,
 *                      "82": 0.08161188662052155,
 *                      "83": -0.05801229551434517,
 *                      "84": -0.09151817113161088,
 *                      "85": -0.11773722618818284,
 *                      "86": -0.07297574728727341,
 *                      "87": 0.02684064395725727,
 *                      "88": 0.18306586146354675,
 *                      "89": -0.029384413734078407,
 *                      "90": 0.005359198898077011,
 *                      "91": 0.1557244509458542,
 *                      "92": 0.01236038189381361,
 *                      "93": -0.06309424340724945,
 *                      "94": 0.028593361377716064,
 *                      "95": 0.019934123381972313,
 *                      "96": -0.15034297108650208,
 *                      "97": -0.056937627494335175,
 *                      "98": -0.11608967930078506,
 *                      "99": -0.055648159235715866,
 *                      "100": 0.086765356361866,
 *                      "101": -0.040616512298583984,
 *                      "102": -0.011480948887765408,
 *                      "103": 0.11656137555837633,
 *                      "104": -0.22738802433013916,
 *                      "105": 0.1095995157957077,
 *                      "106": -0.059297263622283936,
 *                      "107": 0.008117909543216228,
 *                      "108": -0.07157894968986511,
 *                      "109": 0.024347204715013504,
 *                      "110": -0.01826777495443821,
 *                      "111": 0.05584664270281792,
 *                      "112": 0.08860908448696136,
 *                      "113": -0.24369508028030396,
 *                      "114": 0.32270678877830505,
 *                      "115": 0.15934167802333832,
 *                      "116": -0.0578957237303257,
 *                      "117": 0.07711172103881836,
 *                      "118": 0.10568630695343018,
 *                      "119": -0.06963713467121124,
 *                      "120": 0.03982529789209366,
 *                      "121": -0.01975194364786148,
 *                      "122": -0.15063245594501495,
 *                      "123": -0.13803352415561676,
 *                      "124": 0.024464838206768036,
 *                      "125": -0.029291950166225433,
 *                      "126": -0.030947245657444,
 *                      "127": 0.05827851966023445
 *                  }
 *              }
 *          }
 *      }
 *  }
 *}
 * ),
 * @OA\Post(
 *     summary="Login a user (second step)",
 *     path="/api/login/face",
 *     description="Login a user",
 *     tags={"Auth"},
 *     @OA\RequestBody(
 *         required=true,
 *         description="pass user credentials",
 *         @OA\JsonContent(
 *             required={"email", "password"},
 *             @OA\Property(property="email", type="string", format="email", example="admin@admin.com"),
 *             @OA\Property(property="password", type="string", format="password", example="Password123"),
 *             @OA\Property(property="face_token", type="string", example="1|456c0e7f51991d54951aced6f14230eb"),
 *     ),
 * ),
 *     @OA\Response(
 *      response="200",
 *      description="User created successfully",
 *      @OA\JsonContent(
 *         @OA\Property(property="status", type="string", example="success"),
 *         @OA\Property(property="message", type="null", example="null"),
 *         @OA\Property(property="data", type="object",
 *              @OA\Property(property="token", type="string", example="CzU5Acl5F35dDLZkSJpgvUbPJJwPMZwnM0x2KSIo"),
 *         ),
 *      ),
 *     ),
 * ),
 * )
 * @OA\Post(
 *     summary="Login a user (first step)",
 *     path="/api/login",
 *     description="Login a user",
 *     tags={"Auth"},
 *     @OA\RequestBody(
 *         required=true,
 *         description="pass user credentials",
 *         @OA\JsonContent(
 *             required={"email", "password"},
 *             @OA\Property(property="email", type="string", format="email", example="admin@admin.com"),
 *             @OA\Property(property="password", type="string", format="password", example="Password123"),
 *     ),
 * ),
 *     @OA\Response(
 *      response="200",
 *      description="Successful operation",
 *      @OA\JsonContent(
 *     type="object",
 *     ref="#/components/schemas/FaceData"
 * ),
 *     @OA\Response(
 *      response="401",
 *      description="Credentials are not correct",
 *      @OA\JsonContent(
 *         @OA\Property(property="status", type="string", example="error"),
 *         @OA\Property(property="message", type="string", example="Credentials not match"),
 *         @OA\Property(property="data", type="string", example="null"),
 *         ),
 *      ),
 *     @OA\Response(
 *      response="422",
 *      description="The given data was invalid",
 *      @OA\JsonContent(
 *         @OA\Property(property="message", type="string", example="The given data was invalid."),
 *         @OA\Property(property="errors", type="object",
 *              @OA\Property(property="email", type="array",
 *                 @OA\Items(type="string", example="The email has already been taken.")),
 *              @OA\Property(property="password", type="array",
 *                 @OA\Items(type="string", example="The password must be at least 6 characters.")),
 *         ),
 *      ),
 *     ),
 * ),
 * )
 */
class LoginController extends BaseController
{
    use ApiResponser;

    public function sendFaceData(Request $request)
    {
        $attr = $request->validate([
            'email' => 'required|string|email',
            'password' => 'required|string|min:6'
        ]);

        if (!Auth::guard('api')->attempt($attr)) {
            return $this->error('Credentials not match', 401);
        }

        $user = Auth::guard('api')->user();

        return $this->success((new FaceData())->getRandomFaceModels($user->id, 10), 'Retrieved successfully');
    }

    public function authenticate(Request $request)
    {
        $attr = $request->validate([
            'email' => 'required|string|email',
            'password' => 'required|string|min:6',
            'face_token' => 'required|string',
        ]);

        if (!Auth::guard('api')->attempt([
            'email' => $attr['email'],
            'password' => $attr['password'],
        ])) {
            return $this->error('Credentials not match', 401);
        }

        if (!(new FaceData())->validateFaceToken(Auth::guard('api')->user()->id, $attr['face_token'])) {
            return $this->error('Face token is not valid.', 422);
        }

        auth('api')->user()->update(['last_login' => Carbon::now()->toDateTimeString()]);
        return $this->success([
            'token' => auth('api')->user()->createToken('API Token')->plainTextToken
        ]);
    }
}
